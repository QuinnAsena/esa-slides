---
title: "Modelling palaeoecological community data: a state-space approach"
author: "Quinn Asena, Anthony Ives, Jack Williams. and Jonathan Johnson"
institute: "UW-Madison"
date: today
bibliography: refs.bib
from: markdown+emoji
format:
  revealjs:
    theme: dark
#    backgroundcolor: "#44444c"
#    fontcolor: "white"
    preview-links: true
    highlight-style: github
    slide-number: c/t
    width: 1600
    height: 900
title-slide-attributes:
  data-background-color: "#1a1e43"
---

## Is the past recoverable from the data?

:::: {.columns}
::: {.column width="50%"}

```{r, vertical-spp-plot}
#| fig-height: 10
library(patchwork)
library(ggtext)
vertical_plot <- readRDS("./images/vertical_plot.rds")
vertical_plot

```

:::
::: {.column width="50%"}

Palaeoecologists are concerned with questions such as:

- what are the drivers of community change?
- role species-environment interactions?
- role of density dependence and species interactions?
- how can palaeoecological information inform present and future ecosystem states?

:::
::::


## Palaeoecological proxy data

- Typically comprise mulitple time-series (response): 
  - e.g., pollen, diatoms...
- Include environmental covariates (predictors):
  - e.g., isotopic data, charcoal data, lake level...

Palaeoecological data pose many statistical challenges:

- Uneven sampling through time
- Time averaging
- Measurement uncertainty
- Relative abundances


## Descriptive approaches

Many descriptive approaches exist for analysing multivarivariate time-series:

- Cluster analyses: CONISS
- Ordination: PCA, NMDS...
- Machine learning: MVRT, LDA (fancy cluster analyses)

<br>

**Descriptive methods allow us to extract patterns from the data but not determine potential causes of those patterns.**

_Find image of cluster analysis_

## Beyond pattern recognition

The cutting edge in palaeoecology is to establish potential causes of observed patterns in species relative abundances. For example, are observed patterns driven by:

- species interactions?
- climate variability?
- fire regime?
- ...

This is what we want to know if we are to use palaeoecology to inform management of contemporary ecosystems or inform potential future ecosystem states. No easy task!

## State-space modelling

State-space modelling goes beyond descriptive approaches and attempts to estimate:

- autoregressive / density dependent processes 
- interspecific interactions ($C$ matrix)
- species-environment interactions ($B$ vector)
- combinations of the above


## State-space modelling

State-space modelling attempts to predict the "true" unobservable state of a system from observable variables. It does so via two equations, one that models the _process of the system_:

<br>
Process equation:

**Something not right here Tony...:**

$$
Y = B0 + C(Y - B0 - BX) + BX
$$

and one that models the _observations_ from the system:

<br>

Observation equation:

$$
Y_t = Multinomial(z_t)
$$

## State-space modelling

State-space models are not new to ecology and have been used for:

- estimating animal populations
- animal movement
- plant cover data
- and much more

However, state-space models are not well explored in palaeoecology.

## State-space modelling

include eq on slide:

This new variant of a state-space model:

- uses a multinomial distribution: accepts raw count data
- accepts multiple predictor data streams in the same model: e.g., isotopic data, charcoal accumulation rates, fungal spores...
- simultaneously fits multiple coefficients
- models autocorrelation structure


Can be used to assess a range of possible causes of observed patterns in palaeo-data.


## Empirical example

:::: {.columns}

::: {.column width="50%"}

Demonstrating a three-taxon model from Sunfish Pond:

- unpublished data: not presenting the dataset, focusing on the modelling approach (Johnson _et al.,_ unpub)

- ACES project interested in abrupt transitions between dominant species

:::

::: {.column width="50%"}

```{r map}
library(leaflet)
m <- leaflet() %>%
  setView(lng = -76.6990733, lat = 41.6433326, zoom = 5) %>%
  addMarkers(lng = -76.6990733, lat = 41.6433326, popup="Sunfish Pond") %>% addTiles()
m
```
:::
::::

## Jonathon Johnson (JJ)

![](./images/johnson-jonathan-2020.jpg){fig-align="center"}

## Empirical example

This example is a three-taxon model:

- two focal species (_Betula_ and _Quercus_)
- third 'species' is an aggregate of all other species
- we fit species interactions
- estimate species change through time

Remember, this is a multinomial problem so the we do not estimate the aggregate species directly.

## Time-forward model enables even intervals

```{r, plot}
#| fig-align: center
#| fig-cap: Johnson _et al.,_ unpublished
library(patchwork)
library(ggtext)
two_spp_plt <- readRDS("./images/two_spp_plt.rds")
two_spp_plt

```


## Species interaction estimates

:::: {.columns}
::: {.column width="50%"}


$C$ matrix

```{r, summaryc}
x <- readRDS("./data/betula_quercus.rds")
# x$C

c_mat <- x$C
diag(c_mat) <- diag(c_mat) -1
round(c_mat, 3)
```

<br>

- columns = abundance; rows = change in abundance

- density dependence on the diagonal

- _Quercus-Quercus_ near 0 means abundance of _Quercus_ has little affect on the change in _Quercus_

- _Quercus-Betula_ -0.7 means that abundance of _Quercus_ affects the change in _Betula_ abundance


:::
::: {.column width="50%"}

```{r, verticalplot}
#| fig-height: 10
library(patchwork)
library(ggtext)
vertical_ss_plot_1 <- readRDS("./images/vertical_ss_plot_1.rds")
vertical_ss_plot_1

```

:::
::::


## Estimating the effect of covariates

:::: {.columns}
::: {.column width="50%"}

Estimate of change over time

$B$ vector

```{r, summaryb}
round(x$B, 3)
```

<br>

Overall:

- _Quercus_ increases with time
- _Betula_ decreases with time
- estimates are relative!

:::
::: {.column width="50%"}

```{r, verticalplotb}
#| fig-height: 10
library(patchwork)
library(ggtext)
vertical_ss_plot_1 <- readRDS("./images/vertical_ss_plot_1.rds")
vertical_ss_plot_1

```

:::
::::


## Evaluating the model with simulated data

- We cannot determine the accuracy of fitted coefficients empirically from palaeoecological data.

- Simulation experiments are used to assess the success of recovering parameters:
  1. data are simulated under known conditions with replication
  2. the model is fit to the simulated replicate datasets
  3. fitted models are assessed for how well input parameters are recovered

## Evaluating the model with simulated data

:::: {.columns}
::: {.column width="50%"}

$C$ matrix fit to the pollen data

```{r, summarycsim}
round(c_mat, 3)
```
<br>

$B$ vector fit to the pollen data

```{r, summarybsim}
round(x$B, 3)
```

:::
::: {.column width="50%"}

$C$ matrix fit to the simulated data

```{r, summarycdat}

cat("oh")

```
<br>

$B$ vector fit to the simulated data

```{r, summarybdat}
cat("no!")
```

- 100 reps
- average difference between input and fitted parameters

:::
::::


## Hypothesis testing

Link back to parameters themselves

We cannot determine with certainty, outside of simulation, causation from palaeo-data.

What we can do is:

- set up multiple working hypothese (Chamberlin, 1897)
- couple descriptive methods with inferrential ones
- assess which results lend support to the likelihood of each hypothesis being true



## Acknowledgements

- NSF logo (grant reqard number)
- UW logo
- ACES team (names)